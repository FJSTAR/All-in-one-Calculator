<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PPF Calculator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <div class="container">
        <h1 class="text-center">PPF Calculator</h1>
        <div class="row">
            <form id="ppfForm" class="needs-validation" novalidate>
                <div class="mb-3">
                    <label for="investmentAmount" class="form-label">Investment Amount</label>
                    <input type="number" class="form-control" id="investmentAmount" min="0" max="150000" required>
                    <div class="invalid-feedback">
                        Please Enter valid Investment Amount.
                    </div>
                </div>
                <div class="mb-3">
                    <label for="interestRate" class="form-label">Interest Rate (%)</label>
                    <input type="text" class="form-control" id="interestRate" min="0" required>
                    <div class="invalid-feedback">
                        Please Enter valid Interest Rate.
                    </div>
                </div>
                <div class="mb-3">
                    <label for="duration" class="form-label">Duration (Years)</label>
                    <input type="number" class="form-control" id="duration" min="0" required>
                    <div class="invalid-feedback">
                        Please Enter valid Duration.
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Calculate</button>
            </form>
        </div>
    </div>
    <div class="container">
        <figure class="highcharts-figure">
            <div id="container"></div>
        </figure>
        <h1 class="text-center fs-1 text-uppercase">PPF Values</h1>
        <table class="table">
            <thead>
                <tr>
                    <th>Year</th>
                    <th>Opening Balance</th>
                    <th>Amount</th>
                    <th>Interest</th>
                    <th>Closing Balance</th>
                </tr>
            </thead>
            <tbody id="result">

            </tbody>
        </table>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script>
        const ppfForm = document.getElementById('ppfForm');
        ppfForm.addEventListener('submit', function (event) {
            event.preventDefault();
            var investmentAmount = document.getElementById('investmentAmount').value;
            var interestRate = document.getElementById('interestRate').value;
            var duration = document.getElementById('duration').value;
            investmentAmount = parseInt(investmentAmount)
            var openingBalance  = 0;

            for(let i=1; i<=duration; i++){
            var interest = Math.round((openingBalance + investmentAmount)*interestRate/100);
            var closingBalance = openingBalance + investmentAmount + interest;
            console.log(i,openingBalance,investmentAmount,interest,closingBalance);
              
            var trTag = document.createElement("tr");
            var tdTag1 = document.createElement("td");
            var tdTag2 = document.createElement("td");
            var tdTag3 = document.createElement("td");
            var tdTag4 = document.createElement("td");
            var tdTag5 = document.createElement("td");
            tdTag1.innerHTML = i;
            tdTag2.innerHTML = openingBalance;  
            tdTag3.innerHTML = investmentAmount;
            tdTag4.innerHTML = interest;
            tdTag5.innerHTML = closingBalance;

            trTag.appendChild(tdTag1);
            trTag.appendChild(tdTag2);
            trTag.appendChild(tdTag3);
            trTag.appendChild(tdTag4);
            trTag.appendChild(tdTag5);
            
            document.getElementById('result').appendChild(trTag);
            openingBalance = closingBalance;
        }

            Highcharts.chart('container', {
                chart: {
                    type: 'pie'
                },
                title: {
                    text: 'PPF Calculator'
                },
                tooltip: {
                    valueSuffix: '%'
                },
                subtitle: {
                    text:
                        'Source:<a href="https://www.mdpi.com/2072-6643/11/3/684/htm" target="_default">MDPI</a>'
                },
                plotOptions: {
                    series: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: [{
                            enabled: true,
                            distance: 20
                        }, {
                            enabled: true,
                            distance: -40,
                            format: '{point.percentage:.1f}%',
                            style: {
                                fontSize: '1.2em',
                                textOutline: 'none',
                                opacity: 0.7
                            },
                            filter: {
                                operator: '>',
                                property: 'percentage',
                                value: 10
                            }
                        }]
                    }
                },
                series: [
                    {
                        name: 'Percentage',
                        colorByPoint: true,
                        data: [
                            {
                                name: 'Total Investment',
                                y: investmentAmount
                            },
                            {
                                name: 'Total Interest',
                                sliced: true,
                                selected: true,
                                y: interest
                            },
                        ]
                    }
                ]
            })
        });
    </script>
    <script>
        // Example starter JavaScript for disabling form submissions if there are invalid fields
        (() => {
            'use strict'

            // Fetch all the forms we want to apply custom Bootstrap validation styles to
            const forms = document.querySelectorAll('.needs-validation')

            // Loop over them and prevent submission
            Array.from(forms).forEach(form => {
                form.addEventListener('submit', event => {
                    if (!form.checkValidity()) {
                        event.preventDefault()
                        event.stopPropagation()
                    }

                    form.classList.add('was-validated')
                }, false)
            })

            
        })()
    </script>
</body>

</html>